\section{Mathematical Models of the Heart}

Cardiac tissue has been modelled mathematically for about fifty years.
While initial models were simple, there are now models of high sophistication
available.
These models are capable of reproducing both healthy and pathological behaviour
with some accuracy.

\subsection{Advantages of Mathematical Models}

Mathematical modelling offers an attractive alternative to experiments on
cardiac tissue.
This is particularly true when it comes to studies of human cardiac tissue.
However, there are advantages to models of cardiac tissue in all species.

One powerful advantage cardiac models offer is that of dissecting the root cause.
To express this another way, they aid in investigation of which particular
change is the most significant in a case such as a disease or genetic disorder.
In experiments on electrophysiology, the ability to modulate currents depends on
the existence of a drug to block (or open) the channel or even creating an
organism which doesn't express the gene, such as a `knock out mouse'.
In a computer model, this is as easy as removing an equation or tweaking a
parameter.
This can be used to suggest a drug treatment regime for patients.
Of course, such a suggestion will require clinical trials, but modelling can
eliminate non-starters.

Closely linked to the idea of examining the most significant change, cardiac
models can also allow people to `look within'.
This can be achieved on a number of scales.
Cellular models can report on the ionic concentrations, tissue models allow the
voltage distribution to be explored at any level, ECG models allow the
comparison of a known cardiac state and the resulting ECG.
This can, again, be used to suggest further therapies or diagnosis.

Cardiac models have a particular importance when it comes to human models.
Due to ethical considerations, the supply of human cardiac tissue is limited.
Most commonly it comes from posthumous donations of the heart or from biopsies
taken during cardiac surgery.
Both have obvious disadvantages.
In one case, the tissue is dead and thus not suitable for functional studies.
In the other, the biopsy itself may be from pathological tissue and is therefore a
poor guide to healthy function.
Gathering data from the functioning human heart requires surgical intervention,
which must necessarily be kept brief.
Models built from our understanding of how the mammalian heart functions and
the human electrophysiological data currently available therefore offer some of
our best insights into human cardiology.

Another benefit, which cannot be wholly ignored, is cost.
It is quite possible to perform many cardiac simulations on mid- to high- level
desktop PC, costing no more than \pounds 1000.
This includes modelling of cardiac tissues in three dimensions.
Conversely an electrophysiological laboratory can run to tens of thousands of
pounds and that does not include raw materials or animal subjects.

One common theme is the synergy that can emerge between experimental or clinical
work and mathematical modelling.
This can be exploited in work such as patient specific
modelling~\cite{Sermesant2006,Ramanathan2006}\ where a model is adapted to the pathology of a
specific individual.
Models can also be used to suggest hypothesis, such as the role of fibroblasts
in cardiac function and again~\cite{Kohl2005}, which can then be investigated
further in an experimental setting.
To draw on an example from this thesis, the \ii{ANION} case study, they can
also be used to look beyond what is currently possible to examine
experimentally, due to a lack of available drugs and suggest whether developing
such drugs might be worthwhile.

\subsection{Categorising Myocyte Models}

Cellular models tend to be classified in two ways.
The first differentiator is the level of detail employed.
The second is which cellular processes are modelled.

Biophysically detailed models are complex.
They consider the interactions of several different currents, and potentially
intra- and extracellular ion concentrations, reservoirs as well as other
details.
The second type are simplified, phenomenological, models.
These do not consider individual ion concentrations but instead just reproduce
one desired factor, typically the action potential profile.

Models, whether biophysically detailed or not, can concern themselves with the
cellular electrophysiology, the mechanical contractions or both.
This thesis concerns itself just with electrophysiological models.
Models of the mechanics are not considered and are not treated in this
description of mathematical modelling.

\subsection{A Brief History of Cardiac Myocyte Modeling}

The first model of cardiac electrophysiology was published by
Noble~\cite{Noble1962}, and modelled Purkinje fibre (A specialised part of the
ventricular conduction system) action potentials.
Shortly thereafter, various refinements were published, as further experimental
data became available.
This was eventually followed by the Beeler--Reuter~\cite{Beeler1977}\ model of
the guinea pig ventricular myocyte.

The Luo--Rudy guinea pig ventricular myocyte model was first published in
1991~\cite{Luo1991} and was then sub-sequentially majorly revised and
republished in 1994~\cite{Luo1994}.
The first Luo-Rudy model was based on the Beeler--Reuter model, though with updated channel behaviours
and more complex potassium channels.
The second Luo-Rudy model was the first of the `second generation' models,
with fluctuations in all ion concentrations, and a much more detailed series of
equations for calcium handling.

In 1998, the Courtemanche--Ramirez--Natel\cite{CRN98}\ (CRN) model and the
Nygren~\cite{Nygren1998}\ model were published.
These were both models of the human atrium.
They were also both second generation models, with detailed calcium handling.
Also in 1998 Fenton and Karma published their phenomenological
Fenton--Karma~\cite{Fenton1998}\ model, which used just three channels to
reproduce the shape of the ventricular action potential.

\subsection{Mathematical Models of Myocytes}

Mathematical models of cardiac myocytes are built from a few simple assumptions
and considerations.
These concern the behaviour of the cellular membrane and ion channels.
The important ones are detailed here.

\subsubsection{The Nernst Equilibrium Potential}

The Nernst equation is an important equation in electrophysiology~\cite{Fall2002}.
It describes how the difference in ion concentrations on two sides of a
semi-permeable barrier can result in a potential difference across the barrier.
Any voltage dependant factor of a current of an ion, S, includes a reversal
potential, $V_{S}$, equal to the Nernst potential.
At the reversal potential, the current falls to 0.
When equilibrium is reached the potential difference, $V_{S}$, across the
membrane is given by
\begin{equation}
V_{S} = \frac{RT}{zF}ln\left( \frac{[S]_{e}}{[S]_{i}} \right) 
\end{equation} 
where subscripts $i$ and $e$ denote internal and external concentrations of S,
$R$ is the universal gas constant, $T$ is the absolute temperature, $F$ is
Faraday's constant and $z$ the charge of the ion $S$.

The Nernst potential applies only to a single ion concentration.
Since many ion channels are ion channel specific, the Nernst potential can still
be used to calculate the driving potential.

\subsubsection{Electric Circuit Model}

\begin{figure}
\begin{center}
\includegraphics{figures/intro/electrical_circuit_cell}
\end{center}
\caption[Electrical Circuit Model Of The Cell]{
\label{fig:intro:math:circuit}
Electrical circuit representation of the cell.
The cell membrane is represented by a capacitance, $\text{C}_{\text{m}}$.
There are three currents, represented by the conductances $\text{g}_{\text{K}}$,
$\text{g}_{\text{Ca}}$ and $\text{g}_{\text{Na}}$.
The current through the resistances is driven by the three Nernst potentials,
$\text{E}_{\text{K}}$, 
$\text{E}_{\text{Ca}}$ and $\text{E}_{\text{Na}}$.
}
\end{figure}

The electrical circuit model of the cell membrane underpins much of the work in
modelling the behaviour of cardiac myocytes.
It is however a very simple concept.
Since the membrane separates charges, it may be considered as a capacitor, as
shown in figure~\ref{fig:intro:math:circuit}.
Since there is no net buildup of
charge on either side of the membrane, any ionic current, \ii{ion}, must be
countered by a capacitive current, and so
\begin{equation}
C_{m}\frac{dV_{m}}{dt} + \ii{ion} = 0
\label{eqn:intro:math:basic}
\end{equation}
where $V_{m}$ is the membrane voltage, and is defined as the difference between
the internal potential, $u_{i}$ and the external potential, $u_{e}$ or
\begin{equation}
V_{m} = u_{i} - u_{e}
\label{eqn:intro:math:vm}
\end{equation}
When multiple currents are considered, the total inward and outward currents are
summed.
The difficulty comes in determining the form of \ii{ion}, which varies widely
depending on the nature of the channel or pump in question.


\subsubsection{The Hodgkin-Huxley Equations}

Many mathematical models of cardiac myocytes feature one or more
`Hodgkin--Huxley' channels.
Hodgkin and Huxley developed them in a now classic series of papers concerning
the current flow through the membrane of the squid giant
axon~\cite{Hodgkin1952,Keener1998}.
They characterise the current flow with elegance and surprising accuracy.
It is important to note that the Hodgkin--Huxley equations consider the bulk
behaviour of the many thousands of individual channel structures distributed
across the membrane, not the behaviour of one single channel.

Hodgkin and Huxley started with a very simple assumption.
The current flow through a channel on the membrane, $I_{S}$ is given by
\begin{equation}
I_{S} = g_{S}\left(V-V_{S}\right)
\label{eqn:intro:math:hh1}
\end{equation}
where $g_{S}$ is the channel conductance, $V$ the membrane potential and $V_{S}$
the Nernst potential for the ion $S$.
Equation (\ref{eqn:intro:math:hh1}) assumes that the channel is selective for
one ion species S, and that the current is a simple linear function of the
voltage across the membrane.

With this underlying assumption, Hodgkin and Huxley set out to accurately map
the behaviour of the current with regards time and voltage.
The following section explains the description for the sodium current, \ii{Na}.
From the form of the sodium channel under voltage clamp conditions, it is
reasonable to expect $g_{Na}$ obeys a differential equation of the form
\begin{equation}
\frac{dg_{Na}}{dt} = f\left(v,t\right)
\label{eqn:intro:math:hh2}
\end{equation}
where $v=V-V_{Na}$.
However, the form of $g_{Na}$ is complex.
While remaining at the same voltage, the conductance at first increases and then
tails off.
It appeared that there were two processes at work, one that turned the current
on, and one that turned it off.
Hodgkin and Huxley realised that it would be easier to write $g_{Na}$ as a
function of two different variables.
One which corresponded to the turning on and one to the turning off of the
channel.
This leads to there being an activation variable, called $m$, an inactivation
variable, called $h$ and that the current would be some linear combination of the
two, multiplied by a constant conductance factor $\bar{g}_{Na}$.
The two variables $m$ and $h$ would both satisfy a differential equation such as
\begin{equation}
\frac{dm}{dt}=\alpha_{m}\left(v\right)\left(1-m\right) -
\beta_{m}\left(v\right)m
\label{eqn:intro:math:dmdt}
\end{equation}
where $\alpha_{m}$ and $\beta_{m}$ are functions of $v\,\left(=V-V_{Na}\right)$.
As $m$ is an activation, $\alpha_{m}$ and $\beta_{m}$ are such that $m$ is
initially small but increases with the potential allowing current to flow within
the channel.
As $h$ is an inactivation, $\alpha_{h}$ and $\beta_{h}$ give an initially high
value of $h$ that then decays, inactivating the channel.

The form proposed for $g_{Na}$ by Hodgkin and Huxley was
\begin{equation}
g_{Na}=\bar{g}_{Na}m^{3}h
\label{eqn:intro:math:gna}
\end{equation}
where all symbols are as defined previously.
The decision to raise $m$ to the third power was based on the rate of increase
observed in voltage clamp experiments.
It is interesting to note that when the structure of \ii{Na}\ was examined in
detail, it was discovered that the channel has three structures which open to
allow current to flow.
A second type of structure, the `ball and chain', then acts to close the channel.

Many different channels are modelled as Hodgkin--Huxley channels.
Different channels have different activation and inactivation variables.
These variables are modulated by different $\alpha$ and $\beta$ equations.

\subsubsection{Markov Chain Descriptions Of Ion Channels}

Markov chain models of ion channels~\cite{Balser1990,Clancy1999,Silva2005}\
emerged when more detailed information on ion channels became
available.
This included single channel recordings rather than whole cell recordings.
In such conditions, as well as in certain pathological states, the
Hodgkin--Huxley descriptions of the cells broke down.

In a Markov chain model, instead of having one or more activations or
inactivations, the channel has a number of states.
Common states can include open, inactive and closed.
A channel can have more than one state of each sort.
Transitions are only allowed between certain states and each transition has a,
usually time or voltage dependent, probability.
Channels only allow current to flow whilst in an open state.

Markov chain models can be highly complex and contain many states.
They can be utilised in a variety of ways.
One Markov chain can represent the behaviour of all the individual channels on
the cell.
In this case, the total current flowing in the channel will be proportional to
the fraction of open states.
Cells can also have multiple Markov chains to represent the flow through a
channel, each with its own proportions of state occupancy.
They also open the possibility of using stochastic simulation techniques where
the transition between states is controlled by random chance.

\subsection{Selected Myocyte Models}

There are many myocyte models of varying complexity and
accuracy.
There are relatively few models of atrial myocytes for human tissue.
A brief description of the foremost two are given here, as well as a description
of one of the most adaptable phenomenological models.

\subsubsection{The Courtemanche--Rameriz--Nattel Model}
\label{sec:intro:math:crn}

The Courtemanche--Rameriz--Nattel (CRN) model~\cite{CRN98}\ is a biophysically
detailed second generation model of the human atrial myocyte.
It was based on the Luo-Rudy~\cite{Luo1994}\ model of the guinea pig ventricular
myocyte.
The currents were then modified based on data from human and animal atrial
myocytes.
It produces action potentials with a spike and dome morphology.

The CRN model tracks 21 state variables.
Most of these are gating parameters for the many ion channels, but the model
also tracks the internal concentration of potassium, sodium and calcium ions.
The external concentrations of ions are assumed constant.
There are also state parameters representing the calcium stored in internal
structures, such as the sarcoplasmic reticulum.
\begin{align}
\label{eqn:intro:math:crn}
\ii{ion} = \ii{Na} + \ii{K1} + \ii{to} + \ii{Kur} + \ii{Kr} + \ii{Ks} + 
\ii{Ca,L} \nonumber \\
+ \ii{b,Na} + \ii{b,Ca} + \ii{NaK} + \ii{NaCa} + \ii{p,Ca}
\end{align}
The CRN has 12 transmembrane currents and pumps which contribute to \ii{ion},
equation~(\ref{eqn:intro:math:crn}), and 4 currents and
pumps which just interact with the internal calcium stores.
The external currents are \ii{Na}, the fast sodium current, \ii{K1}, the inward
rectifier potassium current, \ii{to}, the transient outward current, \ii{Kur}, the
ultra-rapid delayed rectifier current, \ii{Kr}, the rapid delayed rectifier
current, \ii{Ks}, the slow delayed rectifier current, \ii{Ca,L}, the L-type
calcium current, \ii{b,Na}, the sodium background current and \ii{b,Ca}, the
calcium background current.
All the currents are time-dependent and voltage, except for the background currents which
have constant conductance and \ii{K1}, which is just voltage-dependent.
There are also three pumps; \ii{NaK}, the sodium--potassium exchanger,
\ii{NaCa}, the sodium--calcium exchanger and \ii{p,Ca}, the calcium pump.

As a biophysically detailed model, the CRN model is suitable for a variety of
modelling tasks.
The number of currents make it an attractive option for modelling drugs or
genetic mutations.
It can be expensive to solve for large numbers of cells, however.

\subsubsection{The Nygren Model}

The Nygren model~\cite{Nygren1998}\ is a biophysically detailed second
generation model of the human atrial myocyte.
It was based on the Linblad~\cite{Lindblad1996} model of the rabbit atrium.
The equations were then modified using human data, mostly gathered from the
atrial appendages.
It produces triangular action potentials.

The Nygren model tracks 29 state variables.
Most of these are gating parameters.
They model also tracks concentrations of ions, both internally and in
extracellular cleft spaces, to represent local ion fluctuations.
Like the CRN model, there are also variables to represent internal calcium
handling.
\begin{align}
\label{eqn:intro:math:nygren}
\ii{ion} = \ii{Na} + \ii{K1} + \ii{to} + \ii{Kur} + \ii{Kr} + \ii{Ks} + 
\ii{Ca,L} + \nonumber \\
\ii{b,Na} + \ii{b,Ca} + \ii{NaK} + \ii{NaCa} + \ii{p,Ca}
\end{align}
The Nygren model has 12 transmembrane currents and pumps which contribute to \ii{ion},
equation~(\ref{eqn:intro:math:nygren}), and 4 currents and
pumps which just interact with the internal calcium stores.
The external currents are: \ii{Na}, the fast sodium current, \ii{K1}, the inward
rectifier potassium current, \ii{to}, the transient outward current, \ii{Kur}, the
ultra-rapid delayed rectifier current, \ii{Kr}, the rapid delayed rectifier
current, \ii{Ks}, the slow delayed rectifier current, \ii{Ca,L}, the L-type
calcium current, \ii{b,Na}, the sodium background current and \ii{b,Ca}, the
calcium background current.
All the currents are time- and voltage-dependent, except for the background
currents which have constant coductance and \ii{K1}, which is voltage-dependent.
There are also three pumps; \ii{NaK}, the sodium--potassium exchanger,
\ii{NaCa}, the sodium--calcium exchanger and \ii{p,Ca}, the calcium pump.

The Nygren model has more involved mathematics and requires more storage than
the CRN model, making it less attractive for large-scale simulation.
It is also interesting to note that the two models have very different
AP morphologies, the reasons for which have been the subject of some
research~\cite{Nygren2001,Syed2005,Cherry2008}.

\subsubsection{The Fenton--Karma Model}
\label{sec:intro:math:fk}

The Fenton--Karma (FK) model is a
phenomenological, minimal variable, model of the ventricular action
potential.
The goal of the FK model is to accurately reproduce the AP profile and
restitution properties of myocytes as well as short-term memory effects.
The original FK model has 3 variables, a fourth was added
recently~\cite{Fenton1998,Bueno-Orovio2008}.

The FK model tracks 4 state variables.
These have no true physiological analogues, but certain correlations can be
drawn.
\begin{equation}
\label{eqn:intro:math:fko}
\ii{ion} = \ii{fi} + \ii{si} + \ii{so}
\end{equation}
The FK model has 3 transmembrane currents which contribute to \ii{ion},
equation~(\ref{eqn:intro:math:fko}).
The fast inward current, \ii{fi}, is roughly analogous to the fast sodium
current in more detailed models, the slow inward current, \ii{si}, fulfils a
similar role to the L-type calcium current and the slow outward current, \ii{si},
is analogous to the potassium rectifier currents.
The behaviour of the currents is generally controlled by step functions based
on the state variables.

The FK model is not biophysically detailed.
This makes it very fast to solve, making it attractive for large tissue
simulations.
The drawback of this is that incorporating complex hormonal or drug interactions
is difficult.
The model is highly modifiable, with parameter sets that can reproduce a variety
of AP morphologies and restitution behaviours, including one for atrial myocyte
APs~\cite{Weber2008}.

\subsection{Models of Action Potential Propagation}

Single myocyte models are important, and can tell us much about the heart in
disease and health.
The heart is not made up of isolated myocytes however.
Whilst current computational power does not allow myocytes to be modelled on an
individual cellular basis for the whole heart, continuum models of propagation
have been developed.
These are summed up in the bidomain equations, and their simplification, the
monodomain equations.

\subsubsection{The Bidomain Equation}

The bidomain equation comes out of basic electromagnetic theory and several
assumptions about the nature of cardiac tissue~\cite{Tung1978,Geselowitz1983}.
\begin{enumerate}
    \item The cardiac tissue contains two continuous, simply connected domains,
    the intracellular and extracellular domains separated by the cell membrane.
    There is no detailed consideration of the fine points of geometry.
    \item The intra- and extracellular domains overlap and fill all of the cardiac muscle. Each point lies in both domains.
    \item Charge does not accumulate.
\end{enumerate}

The derivation, starting from Maxwell's Equations, is not that difficult to work
through.
\begin{equation}
\label{eqn:intro:math:maxwell}
\nabla x \mathbf{E} + \mathbf{\dot{B}} = 0
\end{equation}
Treating the situation as quasi-static with no rapid changes of field, $\mathbf{\dot{B}} = 0$, and so
\begin{equation}
\label{eqn:intro:math:maxwellqs}
\nabla x \mathbf{E} = 0
\end{equation}
In this situation, the electrical field, $\mathbf{E}$, can be written as the
divergence of some scalar field, $u$:
\begin{equation}
\label{eqn:intro:math:electricfield}
\mathbf{E} = - \nabla u
\end{equation}
The current which flows in the tissue, $\mathbf{J}$, is then given by the simple
relationship
\begin{equation}
\label{eqn:intro:math:current}
\mathbf{J} = \mathbf{M} \mathbf{E}
\end{equation}
where $\mathbf{M}$ is a tensor of the conductivities in the tissue.
Substituting in (\ref{eqn:intro:math:electricfield}) and using the subscripts
$i$ and $e$ to represent the intra- and extracellular domains, respectively,
expressions for the current flow in each domain are
\begin{subequations}
\label{eqn:intro:math:currentsubs}
\begin{align}
\mathbf{J}_i &=& - \mathbf{M}_i \nabla u_i
\label{eqn:intro:math:currenti}\\
\mathbf{J}_e &=& - \mathbf{M}_e \nabla u_e
\label{eqn:intro:math:currente}
\end{align}
\end{subequations}
Since no charge accumulates (our third assumption), the amount of current
entering a small volume, $\partial V$, must equal the amount of current leaving
the small volume
\begin{equation}
\label{eqn:intro:math:currentvolumeinteg}
\int_{\partial V} \left(\mathbf{J}_i + \mathbf{J}_e\right) \cdot d\mathbf{S} = 0
\end{equation}
The volume $V$ may be arbitrarily chosen and so using the divergence theorem
\begin{equation}
\label{eqn:intro:math:currentdiv}
\nabla \cdot \left(\mathbf{J}_i + \mathbf{J}_e\right) = 0
\end{equation}
Substituting in the equations (\ref{eqn:intro:math:currenti}) and
(\ref{eqn:intro:math:currente}) we obtain
\begin{equation}
\label{eqn:intro:math:currentdivsubst}
\nabla \cdot \left(- \mathbf{M}_i \nabla u_i \right) + \nabla \cdot \left(-\mathbf{M}_e \nabla u_e \right) = 0
\end{equation}
Any current which flows between the two domains must cross the cell membrane, so
\begin{equation}
\label{eqn:intro:math:currentdivim}
- \nabla \cdot \left(- \mathbf{M}_i \nabla u_i \right) = \nabla \cdot \left(-\mathbf{M}_e \nabla u_e \right) = I_m
\end{equation}
where $I_m$ is the transmembrane current.
There is already an expression for $I_m$, given by (\ref{eqn:intro:math:basic}).
This expression is per unit area of the cell surface, whereas we now want current per unit volume.
We therefore introduce $\chi$, the ratio of the cell surface area to the cell volume and so
\begin{equation}
\label{eqn:intro:math:im}
I_m = \chi \left(C_{m}\frac{dV_{m}}{dt} + I_{ion}\right)
\end{equation}

Combining (\ref{eqn:intro:math:currentdivsubst}),
(\ref{eqn:intro:math:currentdivim}) and (\ref{eqn:intro:math:im}) produces
\begin{subequations}
\label{eqn:intro:math:bidom3}
\begin{align}
\nabla\cdot\left(\left(M_{e}\right)\nabla u_{e}\right) + \nabla\cdot\left(M_{i}\nabla u_{i}\right) &=& 0
\label{eqn:intro:math:bidom31}\\
\nabla\cdot\left(M_{i}\nabla u_{i}\right) &=& \chi \left(C_{m}\frac{dV_{m}}{dt} + I_{ion}\right)
\label{eqn:intro:math:bidom32}
\end{align}
\end{subequations}
Which is two equations in three unknowns.  However previously
(\ref{eqn:intro:math:vm}) defined $u_i = V + u_e$ and so substituting and
re-arranging, the bidomain equations are obtained
\begin{subequations}
\label{eqn:intro:math:bidom}
\begin{align}
\nabla\cdot\left(\left(\mathbf{M}_{i}+\mathbf{M}_{e}\right)\nabla u_{e}\right) + \nabla\cdot\left( \mathbf{M}_{i}\nabla V_{m}\right) &=& 0
\label{eqn:intro:math:bidom1}\\
\nabla\cdot\left(\mathbf{M}_{i}\nabla V_{m}\right) + \nabla\cdot\left(\mathbf{M}_{i}\nabla u_{e}\right) &=& \chi \left(C_{m}\frac{dV_{m}}{dt} + I_{ion}\right)
\label{eqn:intro:math:bidom2}
\end{align}
\end{subequations}
where all symbols are as defined previously.
The bidomain equations are a coupled set of a parabolic and elliptic differential equation.

Boundary conditions for the bidomain equations vary, though the most common ones are described here.
First, no intracellular fluxes leave the heart.
Second, the body is assumed to be a passive conductor that is isolated at the outer surface.
The body potential at the surface of the heart is the extra-cellular potential at the surface of the heart.

\subsubsection{The Monodomain Equation}
\label{sec:intro:math:mono}

While the bidomain equations represent a good tool for modelling some of the complexities of cardiac conduction, they are very demanding to solve, necessitating finding the solution to coupled parabolic and elliptic differential equation sets.
The monodomain equation is the result of one simplifying assumption made to the bidomain equations.
For the monodomain equation, we assume that the anisotropy ratio, $\lambda$, is the same for the intra- and extra-cellular fluids at all points.
\begin{equation}
\mathbf{M}_{i} = {\lambda}\mathbf{M}_{e}
\label{eqn:intro:math:mratio}
\end{equation}
This assumption is not a very physiological one, but the simplification it
allows is significant and so it is quite commonly used.

Substituting (\ref{eqn:intro:math:mratio}) into (\ref{eqn:intro:math:bidom1})
and (\ref{eqn:intro:math:bidom2}) and rearranging reduces the pair of equations
to one single equation for the membrane potential
\begin{equation}
\frac{\lambda}{1+\lambda}\nabla\cdot\left(\mathbf{M}_{i}\nabla V_{m}\right) = \chi \left( C_{m}\frac{dV_{m}}{dt} + I_{ion}\right)
\label{eqn:intro:math:mono}
\end{equation}
Typically, the factor of ${\lambda}/\left({1+\lambda}\right)$ is folded into
$M_{i}$, along with $\chi$ and the membrane capacitance $C_m$ to give the diffusion tensor $D$.
In 1D, this is the cable equation.
The values of the components of the tensors $M_{i}$ or $D$ may be determined experimentally, or from a comparison of conduction in real and virtual tissue samples.

\subsection{Numerical Techniques}

There exist a wealth of techniques for solving the ordinary differential
equations (ODEs) and partial differential equations (PDEs) involved in
mathematical models~\cite{Sundnes2006}.
These techniques vary in complexity and accuracy.
The correct choice of technique depends on a number of factors including the
`stiffness' of the equations, the desired accuracy and others.

\subsubsection{The Forward Euler Method}

The forward Euler method~\cite{Birkhoff1989}\ is perhaps the simplest numerical
integration technique.
It requires a relatively small (time) step between integration points.
It is never--the--less quite suitable to use in simulations of the electrical
activity of the heart.
A typical set of ODEs representing the electrical activity of a myocyte are very
`stiff', which is to say they can be numerically unstable if the step size is
too large, and so more sophisticated methods can also require a very small
timestep.

The forward Euler method works as follows.
If we have a function, $f(t, u)$, for which we know the initial
values, $(t_0, u_0)$, then by assuming the rate of change of $f$ remains constant
over some small interval, $h$, we can integrate the equation as follows
\begin{subequations}
\label{eqn:intro:euler}
\begin{align}
t_{n+1} = & t_n + h \label{eqn:intro:euler:t} \\
u_{n+1} = & u_n + hf(t_n, u_n) \label{eqn:intro:euler:x}
\end{align}
\end{subequations}
As long as the interval is small enough the sequence $u_1,u_2,\cdots,u_n$
should be a good approximation of the time evolution of $u$.
If we have more than one value on the right hand side of the equation ($u =
u^{(1)}, u^{(2)}, \cdots, u^{(n)}$) then all values of the right hand side are
assumed constant for each step of the integration.
In cardiac systems, $h$ is typically \ms{0.02}\ or smaller.

\subsubsection{The Finite Difference Method}

The finite difference method~\cite{Morton2005} is a way of calculating the
solution to a spatially extended problem.
Such problems include PDEs such as the bidomain (\ref{eqn:intro:math:bidom}) and
monodomain (\ref{eqn:intro:math:mono}) equations.
The general form of such equations in the variable $u(t, u)$ is
\begin{equation}
\label{eqn:intro:fd:partial}
\frac{\partial u}{\partial t} = \frac{\partial}{\partial x} \left( b(t, x)
\frac{\partial u}{\partial x} \right) + c(t, x)u + d(t, x) + e(t, u)
\end{equation}
Where $t$ is the time, $x$ is the spatial variable and $b$, $c$, $d$ and $e$ are
known functions.
The function $e$ will quite often be \ii{ion}\ for a particular cell.

In the finite difference method, the problem space---the cardiac tissue, in this
thesis---is divided up into a number of nodes.
The spacing between each node is $\Delta x$ in the x direction (and in higher
dimensions,  $\Delta y$ in the y direction and so on).
To advance the solution in time, the forward Euler method
(\ref{eqn:intro:euler}) can be used.
To approximate the differential in space, the centred second difference can be
used.
For the node at $x_i$ at time $t_n$ it is:
\begin{equation}
\label{eqn:intro:fd:secondcentral}
\frac{\partial^2 u}{\partial x^2}\left(x_i, t_n\right) \approx \frac{u(x_{i+1},t_n) - 2u(x_{i},t_n) + u(x_{i-1},t_n) }{\left(\Delta x\right)^2}
\end{equation}
where $i$ is the index of the node, and $n$ the index of the instant of time.
The space centered first difference (needed when conduction anisotropy is to
be taken into account) is:
\begin{equation}
\label{eqn:intro:fd:firstcentral}
\frac{\partial u}{\partial x}\left(x_i, t_n\right) \approx \frac{u(x_{i+1},t_n) - u(x_{i-1},t_n) }{2\left(\Delta x\right)}
\end{equation}

The most common boundary conditions we want to apply are Neumann, `no flux',
boundary conditions where the differential of $u$ with respect to $x$ is set to
zero at the edges of the tissue.
At the edge of the tissue, the approximation for the space differential
(\ref{eqn:intro:fd:secondcentral}) becomes:
\begin{equation}
\label{eqn:intro:fd:secondcentralboundary}
\frac{\partial^2 u}{\partial x^2}\left(x_i, t_n\right) \approx \frac{2\left((u(x_{i-1},t_n) - u(x_{i},t_n) \right)  }{\left(\Delta x\right)^2}
\end{equation}
if the node at $x_{i+1}$ would be `outside' the tissue.
The approximation if the converse is true ($x_{i-1}$ is outside) replaces
$x_{i-1}$ with $x_{i+1}$.
The one dimensional approximation becomes:
\begin{equation}
\label{eqn:intro:fd:firstcentralboundary}
\frac{\partial u}{\partial x}\left(x_i, t_n\right) \approx \frac{u(x_{i},t_n) - u(x_{i-1},t_n) }{\left(\Delta x\right)}
\end{equation}
again, for if the node $x_{i+1}$ is outside.
\begin{figure}
\begin{center}
\includegraphics{figures/intro/stencil}
\end{center}
\caption[5--node Stencil for the Finite Difference Method]{
\label{fig:intro:math:stencil}
Representation of the finite difference method in two dimensions.
The stencil of the central node (solid black) is indicated in red.
}
\end{figure}
In higher orders, (\ref{eqn:intro:fd:secondcentral}) and
(\ref{eqn:intro:fd:firstcentral}) are applied along each direction.
The nodes used in the calculation of the value $u_x$ are known as the stencil.
The typical 5--node stencil used for solving (\ref{eqn:intro:fd:partial}) and
hence (\ref{eqn:intro:math:bidom}) or (\ref{eqn:intro:math:mono}) is illustrated
in figure~\ref{fig:intro:math:stencil}.
Other schemes can use different stencils.


\subsubsection{The Rush--Larsen Technique}

The Rush--Larsen technique~\cite{RL78}\ is a specialised way of solving
equations such as (\ref{eqn:intro:math:dmdt}) for the gating parameters.
Since $\alpha_m$ and $\beta_m$ are dependent only on the voltage, not on time, a
solution to (\ref{eqn:intro:math:dmdt})~\cite{Hodgkin1952} is:
\begin{equation}
\label{eqn:intro:math:dmdtsoln}
m = m_{\inf} - \left(m_{\inf} - m_0\right)\exp\left(-\frac{t}{\tau_m}\right)
\end{equation}
where
\begin{equation}
\label{eqn:intro:math:infm}
m_{\inf} = \frac{\alpha_{m}}{\alpha_{m} + \beta_{m}}
\end{equation}
and
\begin{equation}
\label{eqn:intro:math:taum}
\tau_m = \frac{1}{\alpha_{m} + \beta_{m}}
\end{equation}
where $m_0$ is the initial value of $m$.

Rush and Larsen realised that over a sufficiently small time interval, $\Delta t$,
the parameters $\alpha_m$ and $\beta_m$ could be considered constant.
Taking $m_0$ to be the value of $m(t)$ at time $t$, (\ref{eqn:intro:math:dmdtsoln})
could be used to calculate the next value of $m$, $m(t + \Delta t)$ as:
\begin{equation}
\label{eqn:intro:math:dmdtsolnrl}
m(t+ \Delta t) = m_{\inf} - \left(m_{\inf} - m(t)\right)\exp\left(-\frac{\Delta t}{\tau_m}\right)
\end{equation}
Using (\ref{eqn:intro:math:dmdtsolnrl}) is more accurate than the forward Euler
method (\ref{eqn:intro:euler}), since it depends only on the value of the
membrane potential, not the derivative of $m$.

\subsection{Limitations of Modelling}

Despite the inherent advantages of modelling, it does have disadvantages one
must be aware of as well.
Some of these are intrinsic to models, and others emerge from choices made.
Knowing the weaknesses of modelling can improve the conclusions drawn from
modelling.

One limitation of modelling is that often a choice must be made.
Phenomenological models offer very fast solution times, but do so by sacrificing
physiological detail.
Biophysically detailed models can offer more insight, but can be very slow to
solve, especially for tissue simulations.

The most obvious limitation of modelling is that a model can only ever be as
good as the assumptions and experimental data which are the input.
A model based on incomplete information or inaccurate assumptions is unlikely to
produce acceptable results.
Worse, it can lead to likely looking but erroneous results.

There is also the danger of extrapolation.
This can be particularly true for human models, which are often based on limited
data and supplemented by information from different animal tissues.
One clear example of this is the CRN and Nygren models.
Both are models of human atrial tissue and in addition are largely based on the
same human experimental data.
They have a different action potential morphology, with the CRN showing a spike
and dome morphology whilst the Nygren model producing a triangular morphology.
Both have been observed in human atrial cells~\cite{Wang1993}\ isolated from the
same preparation.
The two cellular models also display different rate dependent adaptation
characteristics~\cite{Cherry2007}.
Despite this, many studies (in this thesis too) select just one model to base
their conclusions on.
Extrapolation can also be an issue when animal electrophysiology differs from
the human, such as in the Purkinje fibres~\cite{Stewart2009}.
In the human Purkinje fibre, the APD is very similar to a ventricular APD,
whereas in canine, rabbit and sheep ventricles, the APD in a Purkinje fibre cell
is prolonged.

Many modelling descriptions are also statistical or homogenised.
The Hodgkin--Huxley equations are a statistical description of cell open states.
The bidomain model (and hence the monodomain) model assume a continuous medium,
rather than the micro-scale connections in human cardiac tissue.
Whilst these are often fine assumptions to make in healthy tissue, disease is
often the state we are more interested in modelling, and in disease these
assumptions can break down.

On a more practical level,  second generation models can have complex
inter-relationships between initial conditions and behaviour.
They have also been shown to exhibit long term drift in ionic
concentrations~\cite{Hund2001}.
These require careful validation of such models, and consideration of long term
behaviours.
